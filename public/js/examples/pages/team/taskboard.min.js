/**
 * Admui-iframe v2.1.0 (http://www.admui.com/)
 * Copyright 2015-2019 Admui Team
 * Licensed under the Admui License 1.1 (http://www.admui.com/about/license)
 */
!function(c,n,d){"use strict";({stageTpl:function(t){return'<li class="taskboard-stage"><header class="taskboard-stage-header"><div class="taskboard-stage-actions float-right"><div class="dropdown"><a data-toggle="dropdown" href="javascript:;" aria-expanded="false"><i class="icon wb-chevron-down" aria-hidden="true"></i></a><div class="dropdown-menu bullet" role="menu"><a class="dropdown-item taskboard-stage-rename" href="javascript:;" role="menuitem"><i class="icon wb-pencil" aria-hidden="true"></i>重命名</a><a class="dropdown-item taskboard-stage-delete" href="javascript:;" role="menuitem"><i class="icon wb-trash" aria-hidden="true"></i>删除</a><div class="taskboard-stage-rename-wrap"><div class="form-group"><input class="form-control taskboard-stage-rename-input" type="text" value="'+t+'" name="name"></div><button class="btn btn-primary btn-block taskboard-stage-rename-save" type="button">保存</button></div></div></div></div><h5 class="taskboard-stage-title">'+t+'</h5></header><div class="taskboard-stage-content"><ul class="list-group taskboard-list"></ul><div class="action-wrap"><a class="add-item-toggle" href="javascript:;"><i class="icon wb-plus" aria-hidden="true"></i>添加任务</a><div class="add-item-wrap"><form class="add-item" role="form" method="post" action="#"><div class="form-group"><label class="control-label mb-15" for="name">任务名称：</label><input class="form-control" type="text" placeholder="任务名称" name="name"></div><div class="form-group text-right"><a class="btn btn-sm btn-white add-item-cancel">取消</a><button type="button" class="btn btn-primary add-item-add">添加</button></div></form></div></div></div></li>'},taskTpl:function(t){return'<li class="list-group-item priority-'+t.priority+'" data-taskboard="slidePanel" data-url="/public/data/examples/pages/taskboard-panel.tpl"><div class="checkbox-custom checkbox-primary"><input type="checkbox" '+(t.complete?'checked="checked"':"")+' name="checkbox"><label class="task-title">'+t.title+'</label></div><div class="task-badges"></div><ul class="task-members"><li><img class="avatar avatar-sm" src="/public/images/portraits/5.jpg"></li></div></li>'},badgesTpl:function(t,a){var e="";switch(t){case"duedate":e='<span class="task-badge task-badge-subtask icon wb-calendar">'+a+"</span>";break;case"subtasks":e='<span class="task-badge task-badge-subtask icon wb-list-bulleted">'+a+"</span>";break;case"attachments":e='<span class="task-badge task-badge-attachments icon wb-paperclip">'+a+"</span>";break;case"comments":e='<span class="task-badge task-badge-comments icon wb-chat">'+a+"</span>"}return e},membersTpl:function(t){return'<li><img class="avatar avatar-sm" src="'+t+'"></li>'},subtaskTpl:function(t){return'<li class="list-group-item subtask"><div class="checkbox-custom checkbox-primary"><input type="checkbox" '+(t.complete?'checked="checked"':"")+' name="checkbox"><label class="title">'+t.title+'</label></div><div class="subtask-editor"><form><div class="form-group"><input class="form-control subtask-title" type="text" name="title"></div><div class="form-group"><button class="btn btn-primary subtask-editor-save" type="button">保存</button><a class="btn btn-sm btn-white subtask-editor-delete" href="javascript:;">删除</a></div></form></div></li>'},attachmentTpl:function(t){return'<li class="list-group-item"><div class="meida"><div class="media-left"><div class="attachments-image"><img src="'+t.src+'"></div></div><div class="media-body"><p><span class="name">'+t.title+'</span><span</p><p><span class="size">'+t.size+'</span><span class="attachments-actions"><button class="btn btn-icon btn-pure" type="button"><i class="icon wb-download" aria-hidden="true"></i></button><button class="btn btn-icon btn-pure" type="button"><i class="icon wb-trash" aria-hidden="true"></i></button></span></p></div></div></li>'},commentTpl:function(t,a,e,s){return'<div class="comment media"><div class="pr-20"><a class="avatar avatar-lg" href="javascript:;"><img src="'+t+'" alt="..."></a></div><div class="media-body"><div class="comment-body"><a class="comment-author" href="javascript:;">'+a+'</a><div class="comment-meta"><span class="date">'+e+'</span></div><div class="comment-content"><p>'+s+"</p></div></div></div></div>"},dataTpl:function(){return{status:!1,title:"",description:"",priority:"normal",duedate:"",members:[],subtasks:[],attachments:[],comments:[]}},init:function(){var e=this;d.getJSON("/public/data/examples/pages/taskboard.json",function(t){var a=d("#taskboard-stages");e.buildStage(a,t),e.initSortable()})},buildStage:function(s,t){var i=this;0!==t.length&&d.each(t,function(t,a){var e=d(i.stageTpl(a.title,a.type));i.buildTask(e,a.tasks),s.append(e)})},buildTask:function(t,a,e){var s,i=this,n=d(".taskboard-list",t);0!==a.length&&(e?(s=d(i.taskTpl(a)),i.buildBadges(s,a),s.data("taskInfo",a),t.append(s)):d.each(a,function(t,a){var e=d(i.taskTpl(a));i.buildBadges(e,a),i.buildMembers(e,a.members),e.data("taskInfo",a),n.append(e)}))},buildBadges:function(t,a){var e,s=this,i="",n=a.duedate,l=a.subtasks,o=a.attachments,c=a.comments;0<n.length&&(i+=s.badgesTpl("duedate",n.split(/\//,2).join("/"))),0<l.length&&(e=0,d.each(l,function(t,a){a.complete&&(e+=1)}),i+=s.badgesTpl("subtasks",e+"/"+l.length)),0<o.length&&(i+=s.badgesTpl("attachments",o.length)),0<c.length&&(i+=s.badgesTpl("comments",c.length)),t.find(".task-badges").html(i)},buildMembers:function(t,a){var e=this,s="";0!==a.length&&(d.each(a,function(t,a){s+=e.membersTpl(a.img)}),t.find(".task-members").html(s))},initSortable:function(){d(".taskboard-stages").sortable({handle:".taskboard-stage-header"}),d(".taskboard-stage .list-group").sortable({connectWith:".taskboard-stage .list-group"})},handleAddStage:function(){var e=this;d(c).on("click",".site-floataction",function(){var t=d("#addStageFrom");d("input",t).val(""),d("option:first",d("select",t)).prop("selected","selected")}),d(c).on("click","#taskboard-stage-creat",function(){var t=d("#addStageFrom"),a=d('[name="name"]',t);d(".taskboard-stages").append(e.stageTpl(a.val())),e.initSortable()})},handleDeleteStage:function(){d(c).on("click",".taskboard-stage-delete",function(){var a=d(this);n.top.layer.alert("您确定要删除吗？",{icon:4},function(t){a.closest(".taskboard-stage").remove(),n.top.layer.close(t)})})},getStage:function(t){return t.closest(".taskboard-stage")},initStageDropdown:function(){d(c).on("click",".taskboard-stage-actions .dropdown-toggle",function(){d(this).next(".dropdown-menu").removeClass("is-edit")})},handleStageRename:function(){d(c).on("click",".taskboard-stage-rename",function(t){var a=d(this).closest(".taskboard-stage-header"),e=d(this).closest(".dropdown-menu"),s=d(".taskboard-stage-rename-input",e),i=d(".taskboard-stage-title",a);e.toggleClass("is-edit"),s.val("").focus().val(i.html()),t.stopPropagation()}),d(c).on("click",".taskboard-stage-rename-save",function(){var t=d(this).closest(".taskboard-stage-header"),a=d(".taskboard-stage-rename-input",t),e=d(".taskboard-stage-title",t),s=a.val();0!==s.length&&e.html(s)})},handleAddTask:function(){var n=this;d(c).on("click",".add-item-toggle, .add-item-add, .add-item-cancel",function(){var t=d(this),a=t.closest(".action-wrap"),e=d('[name="name"]',a);a.toggleClass("action-open"),t.hasClass("add-item-toggle")&&e.val(""),t.hasClass("add-item-toggle")?d(c).on("click.add-item",function(t){0===d(t.target).closest(".add-item-wrap").length&&(a.removeClass("action-open"),d(c).off("click.add-item"))}):d(c).off("click.add-item")}),d(c).on("click",".add-item-add",function(){var t=d(this),a=t.closest(".action-wrap"),e=d('[name="name"]',a),s=d(".taskboard-list",t.closest(".taskboard-stage-content")),i=n.dataTpl();0!==e.val().length&&(i.title=e.val(),n.buildTask(s,i,!0))})},handleDeleteTask:function(){d(c).on("click",".taskboard-task-delete",function(){var a=d(this);n.top.layer.alert("确定要删除此任务吗？",function(t){a.closest(".slidePanel").data("slidePanel").target.remove(),d(".slidePanel-close").trigger("click"),n.top.layer.close(t)})})},handleTaskInput:function(){var s=this;d(c).on("click",".taskboard-list .checkbox-custom input",function(t){var a=d(this),e=a.closest(".list-group-item");s.dataChange(e,"complete",a.prop("checked")),t.stopPropagation()})},handlSlidePanelPlugin:function(){var l=this;void 0!==d.slidePanel&&(d(c).on("click",'[data-taskboard="slidePanel"]',function(s){var t=d(s.target).closest(".list-group-item");d.slidePanel.show({url:d(this).data("url"),target:t},d.concatCpt("slidePanel",{template:function(t){return'<div class="'+t.classes.base+" "+t.classes.base+"-"+t.direction+'"><div class="'+t.classes.base+'-scrollable"><div><div class="'+t.classes.content+'"></div></div></div><div class="'+t.classes.base+'-handler"></div></div>'},afterLoad:function(t){var a=this,e=d(t.target).data("taskInfo");this.$panel.find("."+this.options.classes.base+"-scrollable").mCustomScrollbar(d.concatCpt("mCustomScrollbar")),this.$panel.find("#task-description").markdown({language:"zh"}),0<e.duedate.length&&this.$panel.find("#taskDatepicker").data("date",e.duedate),this.$panel.find("#taskDatepicker").datepicker(d.concatCpt("datepicker",{autoclose:!1,todayHighlight:!0,language:"zh-CN"})).on("changeDate",function(){d("#taskDatepickerInput").val(a.$panel.find("#taskDatepicker").datepicker("getFormattedDate"))}),this.$panel.data("slidePanel",t),d(c).off("click.slidePanelDatepicker"),d(c).on("click.slidePanelDatepicker","span, td, th",function(){s.stopPropagation()})},afterShow:function(){var t=this;d(c).on("click.slidePanelShow",function(){0===d(s.target).closest(".slidePanel").length&&1===d(s.target).closest("body").length&&t.hide()})},afterHide:function(){d(c).off("click.slidePanelShow"),d(c).off("click.slidePanelDatepicker")},contentFilter:function(t,a){var e,s=d(a.target),i=s.data("taskInfo"),n=d(t);switch(d(".stage-name",n).html(d(".taskboard-stage-title",l.getStage(s)).html()),d(".task-title",n).html(i.title),i.priority){case"high":e=d("#priorityHigh",n);break;case"urgent":e=d("#priorityUrgent",n);break;default:e=d("#priorityNormal",n)}return e.prop("checked",!0),l.handleSelective(d('[data-plugin="jquery-selective"]',n),i.members),0===i.description.length?d(".description",n).addClass("is-empty"):d(".description-content",n).html(i.description),0!==i.subtasks.length&&(d.each(i.subtasks,function(t,a){var e=d(l.subtaskTpl(a));d(".subtasks-list",n).append(e)}),d(".subtasks",n).toggleClass("is-show")),0!==i.attachments.length&&(d.each(i.attachments,function(t,a){var e=d(l.attachmentTpl(a));d(".attachments-list",n).append(e)}),d(".attachments",n).toggleClass("is-show")),0!==i.comments.length&&d.each(i.comments,function(t,a){var e=d(l.commentTpl(a.src,a.user,a.time,a.content));d(".comments-history",n).append(e)}),n}})),s.stopPropagation()}),d(c).on("click","#fileuploadToggle",function(){d("#fileupload").trigger("click")}))},handleSelective:function(t,a){var e=this,s=function(){var a=this,s=[];return d.each(this._options.getOptions(this),function(t,e){d.each(a.options.local,function(t,a){a.id===d(e).val()&&s.push(a)})}),s};t.selective({namespace:"addMember",local:[{id:"uid_1",name:"梅小燕",img:"/public/images/portraits/1.jpg"},{id:"uid_2",name:"赵桦",img:"/public/images/portraits/2.jpg"},{id:"uid_3",name:"唐雪琴",img:"/public/images/portraits/3.jpg"},{id:"uid_4",name:"曹洁群",img:"/public/images/portraits/4.jpg"},{id:"uid_5",name:"陈媚婉",img:"/public/images/portraits/5.jpg"},{id:"uid_6",name:"嵇慧莉",img:"/public/images/portraits/6.jpg"}],selected:a,buildFromHtml:!1,tpl:{optionValue:function(t){return t.id},frame:function(){return'<div class="'+this.namespace+'">'+this.options.tpl.items.call(this)+'<div class="'+this.namespace+'-trigger">'+this.options.tpl.triggerButton.call(this)+'<div class="'+this.namespace+'-trigger-dropdown">'+this.options.tpl.list.call(this)+"</div></div></div>"},triggerButton:function(){return'<div class="'+this.namespace+'-trigger-button"><i class="wb-plus"></i></div>'},listItem:function(t){return'<li class="'+this.namespace+'-list-item"><img class="avatar" src="'+t.img+'">'+t.name+"</li>"},item:function(t){return'<li class="'+this.namespace+'-item"><img class="avatar" src="'+t.img+'">'+this.options.tpl.itemRemove.call(this)+"</li>"},itemRemove:function(){return'<span class="'+this.namespace+'-remove"><i class="wb-minus-circle"></i></span>'},option:function(t){return'<option value="'+this.options.tpl.optionValue.call(this,t)+'">'+t.name+"</option>"}},onAfterItemAdd:function(){var t=this.$el.closest(".slidePanel").data("slidePanel").target,a=s.call(this);e.dataChange(t,"members",a)},onAfterItemRemove:function(){var t=this.$el.closest(".slidePanel").data("slidePanel").target,a=s.call(this);e.dataChange(t,"members",a)}})},handlePriority:function(){var e=this;d(c).on("click",'[name="priorities"]',function(){var t=d(this),a=t.closest(".slidePanel").data("slidePanel").target;e.dataChange(a,"priority",t.data("priority"))})},handleEditor:function(){var e=this;d(c).on("click",".slidePanel .task-title, .taskboard-task-edit, .description-toggle",function(){var t=d(this),a=t.closest(".slidePanel").data("slidePanel").target.data("taskInfo");d("#task-title").val(a.title),d("#task-description").val(a.description),t.closest(".slidePanel").find(".task-main").addClass("is-edit")}),d(c).on("click",".task-main-editor-save",function(){var t=d(this),a=t.closest(".slidePanel").data("slidePanel").target;e.dataChange(a,"title",d("#task-title").val()),e.dataChange(a,"description",d("#task-description").val()),t.closest(".slidePanel").find(".task-main").removeClass("is-edit"),0===d("#task-description").val().length?d(".description").addClass("is-empty"):d(".description").removeClass("is-empty")}),d(c).on("click",".task-main-editor-cancel",function(){d(this).closest(".slidePanel").find(".task-main").removeClass("is-edit")})},handleSubtasks:function(){var o=this;d(c).on("click",".subtask-toggle",function(){var t=d(".subtask").length,a=d(".subtasks-add .subtask-title"),e=d(".subtasks");a.val(""),0===t&&e.addClass("is-show"),e.addClass("is-edit"),a.focus(),d(c).on("click.subtask-add",function(t){0===d(t.target).closest(d(".subtasks-add")).length&&(e.removeClass("is-edit"),d(c).off("click.subtask-add"))})}),d(c).on("click",".subtask-add-save",function(){var t,a,e=d(".subtask").length,s=d(".subtasks"),i=d(".subtasks-add .subtask-title"),n=i.val(),l=d(this).closest(".slidePanel").data("slidePanel").target;0===n.length?0===e&&s.removeClass("is-show"):(t={title:n,complete:!1},a=d(o.subtaskTpl(t)),d(".subtasks-list").append(a),o.dataChange(l,"subtasks",t,e)),i.val("").focus()}),d(c).on("click",".subtask-add-cancel",function(){d(".subtasks").removeClass("is-edit"),d(c).off("click.subtask-add")}),d(c).on("click",".subtask input",function(){var t=d(this),a=t.closest(".slidePanel").data("slidePanel").target,e=t.closest(".subtask").index();o.dataChange(a,"subtasks",t.prop("checked"),e,"complete")}),d(c).on("click",".subtask .title",function(){var t=d(this),a=t.closest(".slidePanel").data("slidePanel").target.data("taskInfo"),e=t.closest(".subtask"),s=e.index(),i=d(".subtask-title",e);e.addClass("is-edit"),i.val("").focus().val(a.subtasks[s].title),d(c).on("click.subtask",function(t){0===d(t.target).closest(e).length&&(e.removeClass("is-edit"),d(c).off("click.subtask"))})}),d(c).on("click",".subtask-editor-save",function(){var t=d(this),a=t.closest(".slidePanel").data("slidePanel").target,e=t.closest(".subtask"),s=e.index();o.dataChange(a,"subtasks",d(".subtask-title",e).val(),s,"title"),e.removeClass("is-edit"),d(c).off("click.subtask")}),d(c).on("click",".subtask-editor-delete",function(){var i=d(this);n.top.layer.alert("确定要删除子任务吗？",function(t){var a=i.closest(".slidePanel").data("slidePanel").target,e=i.closest(".subtask"),s=e.index();o.dataDelete(a,"subtasks",s),e.remove(),d(c).off("click.subtask"),0===d(".subtask").length&&d(".subtasks").removeClass("is-show"),n.top.layer.close(t)})})},handleDatepicker:function(){var e=this;d(c).on("click",".due-date-save",function(){var t=d(this).closest(".slidePanel").data("slidePanel").target,a=d("#taskDatepickerInput").val();0<a.length&&e.dataChange(t,"duedate",a)}),d(c).on("click",".due-date-delete",function(){var t=d(this).closest(".slidePanel").data("slidePanel").target;0!==t.data("taskInfo").duedate.length&&(e.dataDelete(t,"duedate"),d("#taskDatepicker").datepicker("clearDates"))})},dataDelete:function(t,a,e){e?(t.data("taskInfo")[a].splice(e,1),this.dataDeleteResponse(t,a,e)):(t.data("taskInfo")[a]="",this.dataChangeResponse(t,a))},dataDeleteResponse:function(t,a){switch(a){case"duedate":case"subtasks":this.buildBadges(t,t.data("taskInfo"))}},dataChange:function(t,a,e,s,i){0!==e.length&&(void 0!==s?i?t.data("taskInfo")[a][s][i]=e:t.data("taskInfo")[a][s]=e:t.data("taskInfo")[a]=e,this.dataChangeResponse(t,a,e,s,i))},dataChangeResponse:function(t,a,e,s,i){switch(a){case"title":d(".task-title",t).html(e),d(".slidePanel .task-title").html(e);break;case"description":d(".slidePanel .description-content").html(e);break;case"priority":t.removeClass("priority-normal priority-high priority-urgent").addClass("priority-"+e);break;case"duedate":this.buildBadges(t,t.data("taskInfo"));break;case"members":this.buildMembers(t,t.data("taskInfo").members);break;case"subtasks":"title"===i?d(".title",d(".subtasks-list .subtask")[s]).html(e):this.buildBadges(t,t.data("taskInfo"))}},run:function(){this.init(),this.handleAddStage(),this.handleDeleteStage(),this.handleAddTask(),this.handleDeleteTask(),this.handleTaskInput(),this.initStageDropdown(),this.handleStageRename(),this.handleDatepicker(),this.handlSlidePanelPlugin(),this.handleEditor(),this.handleSubtasks(),this.handlePriority(),d.leavePage=function(){d.slidePanel=null}}}).run()}(document,window,jQuery);