/**
 * Admui-iframe v2.1.0 (http://www.admui.com/)
 * Copyright 2015-2019 Admui Team
 * Licensed under the Admui License 1.1 (http://www.admui.com/about/license)
 */
!function(d,u,l){"use strict";var f=u.App.getOperPermission();l(function(){var a,r=l("#logsForm"),t=l("#configForm"),e=l('[name="id"]'),o=l('[name="url"]'),n=l('[name="type"]'),i=null,s=l.configs.ctx,c=l(".dataTable").DataTable(l.concatCpt("dataTable",{autoWidth:!1,processing:!0,rowId:"id",ajax:s+"/public/data/system/logconfig/logconfigs.json",columns:[{data:"url"},{data:"type"},{data:"modifyUserName"},{data:"modifyDate"},{render:function(){var t=function(r){var e=!1;return l.each(f,function(t,a){if(a.id===r)return!(e=!0)}),e},a="",r="";return t("110003")&&(r='<button type="button" class="btn btn-xs btn-icon btn-pure btn-default edit-row" data-target="#logsForm" data-toggle="modal"><i class="icon wb-edit" aria-hidden="true"></i></button>'),t("110005")&&(a='<button type="button" class="btn btn-xs btn-icon btn-pure btn-default delete-row"><i class="icon wb-close" aria-hidden="true"></i></button>'),'<div class="btn-group">'+r+a+"</div>"}}]}));i=t.validate({rules:{url:{required:!0},type:{required:!0}},messages:{url:{required:"请填写URL地址"},type:{required:"请填写URL对应名称"}},submitHandler:function(t){l.ajax({url:s+"/logconfig",type:"POST",data:JSON.stringify(l(t).serializeObject()),dataType:"JSON",contentType:"application/json",success:function(t){t.success?(r.modal("hide"),_.isNull(a)?c.row.add(t.data).draw(!1):c.row(a).data(t.data).draw(!1),toastr.success(t.msg)):toastr.error(t.msg)},error:function(){toastr.error("服务器异常，请配合后端程序使用")}})}}),r.on("hidden.bs.modal",function(){t.find("input").val(""),i.resetForm()}),l(d).on("click",".delete-row",function(){var t,r=l(this).closest("tr");t=r.hasClass("child")?c.row(r.prev()).id():c.row(r).id(),u.top.layer.confirm("你确定要删除吗？",function(a){l.ajax({url:s+"/logconfig/"+t,type:"DELETE",dataType:"JSON",success:function(t){t.success?(c.row(r).remove().draw(!1),toastr.success(t.msg),u.top.layer.close(a)):toastr.error(t.msg)},error:function(){toastr.error("服务器异常，请配合后端程序使用")}})})}),l(".add-row").on("click",function(){a=null,e.val("")}),l(d).on("click",".edit-row",function(){var t;a=l(this).closest("tr"),t=c.row(a).data(),e.val(t.id),o.val(t.url),n.val(t.type)})})}(document,window,jQuery);