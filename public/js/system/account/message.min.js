/**
 * Admui-iframe v2.1.0 (http://www.admui.com/)
 * Copyright 2015-2019 Admui Team
 * Licensed under the Admui License 1.1 (http://www.admui.com/about/license)
 */
!function(o,e,c){"use strict";var t={loadMsg:function(t){o.top.notifyFn.render(),c.ajax({url:c.configs.ctx+"/public/data/system/message/messages.json",dataType:"JSON",type:"GET",data:{pageIndex:t,pageSize:10},success:function(t){var e;t&&void 0!==t.pageList?(e=template("newMessge",t),c("#messageLists").html(e)):toastr.error(t.msg)},error:function(t){toastr.error(t)}})},fnExtend:function(){var e=this;c.extend(o.top.notifyFn,{messagePage:function(){var t=c("#messageLists");c(".account-msg").hasClass("active")&&(0===t.children(".no-message").length&&1!==c("#paging").data("page")||e.loadMsg(1))},msgStatus:function(t){var e=c('[data-id="'+t+'"]').children(".media"),a=e.children(".media-right").find("a");e.children(".media-body").find("i").remove(),a.attr("title","删除"),a.removeClass("wb-check").addClass("wb-close")}})},run:function(){var r=this,t=o.top.notifyFn.unReadMsg;this.loadMsg(1),this.fnExtend(),t&&c.isFunction(t)&&t(c("#admui-navbarMessage").find("span.msg-num").text()),c(e).on("click",".news-list",function(t){var e=c(this),a=e.parents(".list-group-item").data();a.readFlag=e.find("i.icon").length<=0,o.top.notifyFn.readMsg(a),t.preventDefault()}),c(e).on("click",".wb-check",function(t){t.preventDefault(),o.top.notifyFn.readMsg(c(this).parents("[data-id]").data())}),c(e).on("click",".wb-close",function(t){var e=c(this).closest(".list-group-item"),a=c(".msg-number"),s=Number(a.text()),n=c("#paging").data("page"),i=e.data("id");o.top.layer.confirm("你确定要删除吗？",function(e){c.ajax({url:"/message/"+i,type:"DELETE",dataType:"JSON",success:function(t){t.success?(r.loadMsg(n),s-=1,a.text(s),toastr.clear(),toastr.success(t.msg),o.top.layer.close(e)):toastr.error(t.msg)},error:function(t){toastr.error(t)}})}),t.preventDefault()}),c(e).on("click",".previous, .next",function(){var t=c(this),e=t.parents("#paging").data("page"),a=t.parents("#paging").data("max-page"),s=c(".previous"),n=c(".next");t.is(".previous")?(n.is(":hidden")&&n.show(),2===e&&s.hide(),e-=1):t.is(".next")&&(s.is(":hidden")&&s.show(),e===a-1&&n.hide(),e+=1),r.loadMsg(e)})}};template.defaults.imports.iconType=function(t){switch(t){case"SYSTEM":return"fa-desktop system";case"TASK":return"fa-tasks task";case"SETTING":return"fa-cog setting";case"EVENT":return"fa-calendar event";default:return"fa-comment-o other"}},template.defaults.imports.timeMsg=function(t){var e=new Date,a=t.split(/[- :/]/),s=new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5]);return o.top.notifyFn.timeDistance(s,e)},c(function(){t.run()})}(window,document,jQuery);