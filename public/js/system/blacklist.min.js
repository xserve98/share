/**
 * Admui-iframe v2.1.0 (http://www.admui.com/)
 * Copyright 2015-2019 Admui Team
 * Licensed under the Admui License 1.1 (http://www.admui.com/about/license)
 */
!function(s,e,o){"use strict";var c=s.App.getOperPermission();o(function(){var n,i=o.configs.ctx,t=o("#blackList"),r=o("#modal"),a=null;n=o(".dataTable").DataTable(o.concatCpt("dataTable",{autoWidth:!1,processing:!0,rowId:"id",ajax:i+"/public/data/system/blacklist/blacklists.json",columns:[{render:function(t,a,e,r){return r.row+1}},{data:"ip",render:function(t){return'<a href="javascript:;" class="ip-msg" data-url="/info/ip?ip='+t+'">'+t+"</a>"}},{data:"createDate"},{data:"remark"},{render:function(){var e,r,t="";return r=!(e="700003"),o.each(c,function(t,a){if(a.id===e)return!(r=!0)}),r&&(t='<a class="btn btn-pure btn-xs btn-default icon wb-close delete-tr" href="javascript:;"></a>'),t}}],drawCallback:function(){var t;this.api().column(0).nodes().each(function(t,a){t.innerHTML=a+1}),(t=o("table .ip-msg")).webuiPopover(o.extend(!0,{},o.concatCpt("webuiPopover"),t.data(),{trigger:"click",title:"详细信息",type:"async",content:function(t){var a="出错了，请重试！";return t.success&&(a=t.msg),a}}))}})),a=t.validate({ignore:".ignore",rules:{ip:{required:!0,ipv4:!0}},submitHandler:function(t){var a=o(t),e={ip:a.find('[name="ip"]').val(),remark:a.find('[name="comment"]').val()};o.ajax({url:i+"/blacklist",type:"POST",data:JSON.stringify(e),dataType:"JSON",contentType:"application/json",success:function(t){t.success?(n.row.add(t.data).draw(!1),toastr.success(t.msg),r.modal("hide")):toastr.error(t.msg)},error:function(){toastr.error("服务器异常，请配合后端程序使用")}})}}),r.on("hidden.bs.modal",function(){t.find("input, textarea").val(""),a.resetForm()}),o(e).on("click",".delete-tr",function(t){var e,r=o(this).closest("tr");e=r.hasClass("child")?n.row(r.prev()).id():n.row(r).id(),s.top.layer.confirm("你确定要删除吗？",function(a){o.ajax({url:i+"/blacklist/"+e,type:"DELETE",dataType:"JSON",success:function(t){t.success?(n.row(r).remove().draw(!1),toastr.success(t.msg),s.top.layer.close(a)):toastr.error(t.msg)},error:function(){toastr.error("服务器异常，请稍后再试！")}})}),t.preventDefault()})})}(window,document,jQuery);